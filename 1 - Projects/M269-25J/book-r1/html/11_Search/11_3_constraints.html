

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>11.3. Constraint satisfaction</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/m269.css?v=4f7d186f" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=7f41d439"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11.4. Searching permutations" href="11_4_permutations.html" />
    <link rel="prev" title="11.2. Factorisation" href="11_2_factorisation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            M269
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_Introduction/01-introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_Sequence/02-introduction.html">2. Numbers and sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Selection/03-introduction.html">3. Booleans and selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_Iteration/04-introduction.html">4. Sequences and iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_TMA01-1/05-introduction.html">5. TMA 01 part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_Implementing/06-introduction.html">6. Implementing sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_Ordered/07-introduction.html">7. Stacks and queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08_Unordered/08-introduction.html">8. Unordered collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_Practice-1/09-introduction.html">9. Practice 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_TMA01-2/10-introduction.html">10. TMA 01 part 2</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="11-introduction.html">11. Exhaustive search</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="11_1_linear.html">11.1. Linear search, again</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_2_factorisation.html">11.2. Factorisation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">11.3. Constraint satisfaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Problem">11.3.1. Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Algorithm-and-complexity">11.3.2. Algorithm and complexity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Code-and-performance">11.3.3. Code and performance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Exercise-11.3.1">Exercise 11.3.1</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Don't-generate-equivalent-candidates">11.3.4. Don’t generate equivalent candidates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reduce-the-range">11.3.5. Reduce the range</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Compute-part-of-a-candidate">11.3.6. Compute part of a candidate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Improved-code-and-performance">11.3.7. Improved code and performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="11_4_permutations.html">11.4. Searching permutations</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_5_subsets.html">11.5. Searching subsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_6_practice.html">11.6. Practice</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_7_summary.html">11.7. Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../12_Recursion/12-introduction.html">12. Recursion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../13_Divide/13-introduction.html">13. Divide and conquer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../14_Sorting/14-introduction.html">14. Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../15_TMA02-1/15-introduction.html">15. TMA 02 part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../16_Trees/16-introduction.html">16. Rooted trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../17_Graphs_1/17-introduction.html">17. Graphs 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../18_Greed/18-introduction.html">18. Greed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../19_Practice-2/19-introduction.html">19. Practice 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../20_TMA02-2/20-introduction.html">20. TMA 02 part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../21_Graphs_2/21-introduction.html">21. Graphs 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../22_Backtracking/22-introduction.html">22. Backtracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../23_Dynamic_Programming/23-introduction.html">23. Dynamic Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../24_Practice-3/24-introduction.html">24. Practice 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../25_TMA03-1/25-introduction.html">25. TMA 03 part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../26_Complexity_classes/26-introduction.html">26. Complexity classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../27_Computability/27-introduction.html">27. Computability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../28_TMA03-2/28-introduction.html">28. TMA 03 part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../31_Hints/31-introduction.html">29. Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../32_Answers/32-introduction.html">30. Answers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../33_Figures/33-introduction.html">31. Figures</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">M269</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="11-introduction.html"><span class="section-number">11. </span>Exhaustive search</a></li>
      <li class="breadcrumb-item active"><span class="section-number">11.3. </span>Constraint satisfaction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Constraint-satisfaction">
<h1><span class="section-number">11.3. </span>Constraint satisfaction<a class="headerlink" href="#Constraint-satisfaction" title="Link to this heading"></a></h1>
<p>Sometimes we must search for each item that satisfies the conditions. Other times we must search for multiple items that <em>together</em> satisfy the conditions. That’s a form of <strong>constraint satisfaction problem</strong> (<strong>CSP</strong>). The earlier example of checking if a password is valid is a CSP with two constraints: the string must include a lowercase letter and a digit. We search for two candidates (characters) that together satisfy the conditions because no character can satisfy both by itself.</p>
<p>CSPs occur often in business, engineering, manufacturing and many other domains. A classic CSP is timetabling: which class should be taught where and when? Constraints include teaching each class in a sufficiently large room, teaching some classes in specialised rooms (e.g. labs), and making sure no one is scheduled for different classes at the same time.</p>
<p>Constraints are often described with mathematical equations or inequalities. Solving a CSP amounts to assigning values to all variables so that the constraints are satisfied. There are advanced specialised techniques to solve CSPs. In M269 we’ll solve them with exhaustive search only.</p>
<p>This section introduces more techniques to make exhaustive search faster.</p>
<section id="Problem">
<h2><span class="section-number">11.3.1. </span>Problem<a class="headerlink" href="#Problem" title="Link to this heading"></a></h2>
<p>Consider the following CSP.</p>
<blockquote>
<div><p>Given positive integers <em>sum</em>, <em>product</em> and <em>square sum</em>, find all distinct integers <em>x</em>, <em>y</em> and <em>z</em> such that <em>x</em>+<em>y</em>+<em>z</em> = <em>sum</em>, <em>x</em>×<em>y</em>×<em>z</em> = <em>product</em> and <em>x</em>² + <em>y</em>² + <em>z</em>² = <em>square sum</em>.</p>
</div></blockquote>
<p>This problem has three constraints in the form of equations and another three constraints in the form of inequalities: <em>x</em> ≠ <em>y</em>, <em>y</em> ≠ <em>z</em> and <em>z</em> ≠ <em>x</em>.</p>
<p>Some examples:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><em>sum</em></p></th>
<th class="head"><p><em>product</em></p></th>
<th class="head"><p><em>square sum</em></p></th>
<th class="head"><p><em>x</em></p></th>
<th class="head"><p><em>y</em></p></th>
<th class="head"><p><em>z</em></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>6</p></td>
<td><p>6</p></td>
<td><p>14</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>6</p></td>
<td><p>14</p></td>
<td><p>−1</p></td>
<td><p>−2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>21</p></td>
<td><p>336</p></td>
<td><p>149</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>33</p></td>
<td><p>1320</p></td>
<td><p>365</p></td>
<td><p>10</p></td>
<td><p>11</p></td>
<td><p>12</p></td>
</tr>
</tbody>
</table>
<p>Note that this isn’t a test table because the problem asks for all solutions <em>x</em>, <em>y</em>, <em>z</em> for each input, but I’ve provided only one. I actually don’t know whether there are other solutions for these inputs.</p>
<div class="admonition note">
<p><strong>Info:</strong> This is a slightly modified version of problem <a class="reference external" href="https://onlinejudge.org/external/115/11565.pdf">Simple Equations</a>.</p>
</div>
</section>
<section id="Algorithm-and-complexity">
<h2><span class="section-number">11.3.2. </span>Algorithm and complexity<a class="headerlink" href="#Algorithm-and-complexity" title="Link to this heading"></a></h2>
<p>The solutions are triples of integers, so the output will be a set of tuples (<em>x</em>, <em>y</em>, <em>z</em>). We generate all possible triples with three nested loops. First we must determine a range of possible candidates for each integer.</p>
<p>The sum doesn’t constrain the values: I can set <em>x</em> as small or large as I want and still find a solution (<em>y</em> = –<em>x</em> and <em>z</em> = <em>sum</em>). However, the product equation forces each value to be in the range from –<em>product</em> to <em>product</em>. If any value is outside that range, then one of the other two is a real number between −1 and 1, not an integer.</p>
<ol class="arabic simple">
<li><p>let <em>solutions</em> be the empty set</p></li>
<li><p>for each <em>x</em> from –<em>product</em> to <em>product</em>:</p>
<ol class="arabic simple">
<li><p>for each <em>y</em> from –<em>product</em> to <em>product</em>:</p>
<ol class="arabic simple">
<li><p>for each <em>z</em> from –<em>product</em> to <em>product</em>:</p>
<ol class="arabic simple">
<li><p>if <em>x</em>, <em>y</em> and <em>z</em> satisfy the constraints:</p>
<ol class="arabic simple">
<li><p>add (<em>x</em>, <em>y</em>, <em>z</em>) to <em>solutions</em></p></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>Steps 2, 2.1 and 2.1.1 generate the candidates and step 2.1.1.1 tests them: it checks <em>x</em> ≠ <em>y</em> ≠ <em>z</em> ≠ <em>x</em> and the three equations. A single Boolean expression for checking four constraints is too long, so I’ll implement the test with a separate auxiliary function.</p>
<p>Each for-loop does 2 × <em>product</em> + 1 iterations: –<em>product</em>, …, –1, 0, 1, …, <em>product</em>. Testing a candidate requires a fixed number of arithmetic operations. The overall complexity is (2 × <em>product</em> + 1)³ × Θ(1) = Θ(<em>product</em>³) because constants are ignored.</p>
<p>This is called <strong>cubic</strong> complexity. Quadratic algorithms are to be avoided when possible; cubic algorithms even more so.</p>
</section>
<section id="Code-and-performance">
<h2><span class="section-number">11.3.3. </span>Code and performance<a class="headerlink" href="#Code-and-performance" title="Link to this heading"></a></h2>
<p>Let’s implement the algorithm to see how slowly it runs. For the Python code, I’ll use the name <code class="docutils literal notranslate"><span class="pre">addition</span></code> instead of <code class="docutils literal notranslate"><span class="pre">sum</span></code> as the latter is a built-in function.</p>
<p>In Python we can nest functions inside each other. This is useful to write auxiliary functions that aren’t used by anyone else. The inner function can access the arguments of the outer function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">equations</span><span class="p">(</span><span class="n">addition</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">product</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">square_sum</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all triples that satisfy the constraints.</span>

<span class="sd">    Preconditions: addition &gt; 0, product &gt; 0, square_sum &gt; 0</span>
<span class="sd">    Postconditions: the output has exactly all (x, y, z) such that</span>
<span class="sd">    - x ≠ y ≠ z ≠ x and x, y, z are integers</span>
<span class="sd">    - x+y+z = addition, x*y*z = product, x² + y² + z² = square_sum</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">satisfies</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if x, y and z satisfy the constraints.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="n">z</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">addition</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">product</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span> <span class="o">==</span> <span class="n">square_sum</span>

    <span class="n">solutions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">product</span><span class="p">,</span> <span class="n">product</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">product</span><span class="p">,</span> <span class="n">product</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">product</span><span class="p">,</span> <span class="n">product</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">satisfies</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
                    <span class="n">solutions</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">solutions</span>
</pre></div>
</div>
</div>
<p>Let’s test this with the simplest example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">equations</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(1, 2, 3), (1, 3, 2), (2, 1, 3), (2, 3, 1), (3, 1, 2), (3, 2, 1)}
</pre></div></div>
</div>
<p>Oh dear! We get several times the same solution, only in a different order. I’ll deal with that in a moment. First, let’s time the execution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> -r 3 equations(6, 6, 14)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
143 μs ± 273 ns per loop (mean ± std. dev. of 3 runs, 10,000 loops each)
</pre></div></div>
</div>
<p>This example (<em>product</em> = 6) required (2×6 + 1)³ = 2197 iterations, because each loop goes from −6 to 6. If you divide the time shown by 2197, you will know how long it takes to generate and test each triplet <em>x</em>, <em>y</em>, <em>z</em>. (I don’t know the run-time in advance, so you have to do the calculation yourself.)</p>
<section id="Exercise-11.3.1">
<h3>Exercise 11.3.1<a class="headerlink" href="#Exercise-11.3.1" title="Link to this heading"></a></h3>
<p>Now that you know the time it takes to generate and test each triplet, you can estimate the total run-time for any value of <em>product</em>. Such back-of-the-envelope estimates of the running time help decide if the performance is acceptable or a better algorithm is needed.</p>
<p>Using Python as a calculator, write an expression that computes the time, in seconds, for the algorithm to solve the earlier example with <em>product</em> = 336. If you haven’t calculated the exact time for each iteration (i.e. triplet), assume each iteration takes 100 ns. (There are one billion, i.e. a thousand million, nanoseconds in a second.)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">pass</span>
</pre></div>
</div>
</div>
<p>Now write an expression to compute the time in minutes for solving the example with <em>product</em> = 1320.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">pass</span>
</pre></div>
</div>
</div>
<p><a class="reference internal" href="../31_Hints/Hints_11_3_01.html"><span class="doc">Hint</span></a> <a class="reference internal" href="../32_Answers/Answers_11_3_01.html"><span class="doc">Answer</span></a></p>
<div class="admonition warning">
<p><strong>Note:</strong> Knowing the complexity and the run-time for a small input, you can estimate the run-times for large inputs.</p>
</div>
</section>
</section>
<section id="Don't-generate-equivalent-candidates">
<h2><span class="section-number">11.3.4. </span>Don’t generate equivalent candidates<a class="headerlink" href="#Don't-generate-equivalent-candidates" title="Link to this heading"></a></h2>
<p>The algorithm is generating all <a class="reference internal" href="../04_Iteration/04_1_sequences.html#Sorting"><span class="std std-ref">permutations</span></a> of the same values because the order in which values are added or multiplied doesn’t matter. All those solutions are equivalent; we should generate only one of them.</p>
<p>The easiest way to generate only one of several permutations is to sort the values, e.g. to only generate triples with <em>x</em> &lt; <em>y</em> &lt; <em>z</em>. This ensures the three values are distinct by construction, which makes the test simpler and more efficient, as it only has to check the equations.</p>
<ol class="arabic simple">
<li><p>let <em>solutions</em> be the empty set</p></li>
<li><p>for each <em>x</em> from –<em>product</em> to <em>product</em>:</p>
<ol class="arabic simple">
<li><p>for each <em>y</em> from <em>x</em> + 1 to <em>product</em>:</p>
<ol class="arabic simple">
<li><p>for each <em>z</em> from <em>y</em> + 1 to <em>product</em>:</p>
<ol class="arabic simple">
<li><p>if <em>x</em>, <em>y</em> and <em>z</em> satisfy the equations:</p>
<ol class="arabic simple">
<li><p>add (<em>x</em>, <em>y</em>, <em>z</em>) to <em>solutions</em></p></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>Imposing an order on the triple’s values reduces the size of the output set and, more importantly, of the search space: steps 2.1 and 2.1.1 now generate fewer candidates for <em>y</em> and <em>z</em>.</p>
</section>
<section id="Reduce-the-range">
<h2><span class="section-number">11.3.5. </span>Reduce the range<a class="headerlink" href="#Reduce-the-range" title="Link to this heading"></a></h2>
<p>Another technique is to avoid generating candidates that will fail the test. In the case of integers, that means making the range of candidates as small as possible, while still making sure it contains all solutions.</p>
<p>We only used the product equation to set the initial search space. The equation</p>
<p><em>x</em>² + <em>y</em>² + <em>z</em>² = <em>square sum</em></p>
<p>may be useful too. Square numbers are never negative: if any of them is larger than <em>square sum</em>, then the constraint can’t be satisfied. So <em>x</em>, <em>y</em> and <em>z</em> must be in the range –<span class="math notranslate nohighlight">\(\sqrt{\textit{square sum}}\)</span> to <span class="math notranslate nohighlight">\(\sqrt{\textit{square sum}}\)</span>.</p>
<p>When we have multiple ranges, the values must be in their intersection. In this case, one range is contained in the other, because both go from −<em>limit</em> to +<em>limit</em> for some integer <em>limit</em>, so we take the smallest range. The algorithm becomes:</p>
<ol class="arabic simple">
<li><p>let <em>solutions</em> be the empty set</p></li>
<li><p>let <em>limit</em> be min(<em>product</em>, floor(<span class="math notranslate nohighlight">\(\sqrt{\textit{square sum}}\)</span>))</p></li>
<li><p>for each <em>x</em> from –<em>limit</em> to <em>limit</em>:</p>
<ol class="arabic simple">
<li><p>for each <em>y</em> from <em>x</em> + 1 to <em>limit</em>:</p>
<ol class="arabic simple">
<li><p>for each <em>z</em> from <em>y</em> + 1 to <em>limit</em>:</p>
<ol class="arabic simple">
<li><p>if <em>x</em>, <em>y</em> and <em>z</em> satisfy the equations:</p>
<ol class="arabic simple">
<li><p>add (<em>x</em>, <em>y</em>, <em>z</em>) to <em>solutions</em></p></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>Consider the example with <em>product</em> = 336 and <em>square sum</em> = 149. The original algorithm generates (2 × 336 + 1)³ ≈ 305 million candidates; the new algorithm generates far fewer than (2 × floor(<span class="math notranslate nohighlight">\(\sqrt{149}\)</span>) + 1)³ = 25³ ≈ 16 thousand, because the loops for <em>y</em> and <em>z</em> never start at <span class="math notranslate nohighlight">\(−\sqrt{149}\)</span>. A vast reduction in the search space!</p>
</section>
<section id="Compute-part-of-a-candidate">
<h2><span class="section-number">11.3.6. </span>Compute part of a candidate<a class="headerlink" href="#Compute-part-of-a-candidate" title="Link to this heading"></a></h2>
<p>Last but not least, when a constraint creates a dependency between values, we can directly compute one value from the others instead of searching for it.</p>
<div class="admonition warning">
<p><strong>Note:</strong> The best way to make searches efficient is to avoid searches.</p>
</div>
<p>For this problem, once we have candidate values for <em>x</em> and <em>y</em> we can use one equation to determine the value of <em>z</em> and then check the other two equations. The sum equation is the simplest to compute <em>z</em>.</p>
<p>Here’s the new algorithm, with sqrt(…) representing the square root function, to simplify the notation.</p>
<ol class="arabic simple">
<li><p>let <em>solutions</em> be the empty set</p></li>
<li><p>let <em>limit</em> be min(<em>product</em>, floor(sqrt(<em>square sum</em>)))</p></li>
<li><p>for each <em>x</em> from –<em>limit</em> to <em>limit</em>:</p>
<ol class="arabic simple">
<li><p>for each <em>y</em> from <em>x</em> + 1 to <em>limit</em>:</p>
<ol class="arabic simple">
<li><p>let <em>z</em> be <em>sum</em> − <em>x</em> − <em>y</em></p></li>
<li><p>if <em>y</em> &lt; <em>z</em> and <em>x</em>×<em>y</em>×<em>z</em> = <em>product</em> and <em>x</em>²+<em>y</em>²+<em>z</em>² = <em>square sum</em>:</p>
<ol class="arabic simple">
<li><p>add (<em>x</em>, <em>y</em>, <em>z</em>) to <em>solutions</em></p></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>Since <em>z</em> is no longer generated by a loop starting at <em>y</em> + 1, we must explicitly check for <em>y</em> &lt; <em>z</em>.</p>
<p>Continuing with the same example, the new algorithm generates at most 25² = 625 candidates, down from 25³ ≈ 16 thousand.</p>
</section>
<section id="Improved-code-and-performance">
<h2><span class="section-number">11.3.7. </span>Improved code and performance<a class="headerlink" href="#Improved-code-and-performance" title="Link to this heading"></a></h2>
<p>Let’s implement the final algorithm, test it and measure its performance. I won’t repeat the docstring. I will use Python’s square root function <code class="docutils literal notranslate"><span class="pre">sqrt</span></code>, defined in module <code class="docutils literal notranslate"><span class="pre">math</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fast_equations</span><span class="p">(</span><span class="n">addition</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">product</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">square_sum</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>  <span class="c1"># noqa: D103</span>
    <span class="n">solutions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square_sum</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">limit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">addition</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">z</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">==</span> <span class="n">product</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span> <span class="o">==</span> <span class="n">square_sum</span><span class="p">:</span>
                <span class="n">solutions</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">solutions</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fast_equations</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="o">%</span><span class="k">timeit</span> -r 3 fast_equations(6, 6, 14)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(1, 2, 3)}
1.64 μs ± 1.83 ns per loop (mean ± std. dev. of 3 runs, 1,000,000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fast_equations</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="o">%</span><span class="k">timeit</span> -r 3 fast_equations(0, 6, 14)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(-2, -1, 3)}
1.29 μs ± 2.52 ns per loop (mean ± std. dev. of 3 runs, 1,000,000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fast_equations</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">336</span><span class="p">,</span> <span class="mi">149</span><span class="p">))</span>
<span class="o">%</span><span class="k">timeit</span> -r 3 fast_equations(21, 336, 149)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(6, 7, 8)}
15 μs ± 119 ns per loop (mean ± std. dev. of 3 runs, 100,000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fast_equations</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">1320</span><span class="p">,</span> <span class="mi">365</span><span class="p">))</span>
<span class="o">%</span><span class="k">timeit</span> -r 3 fast_equations(33, 1320, 365)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(10, 11, 12)}
35.1 μs ± 15.1 ns per loop (mean ± std. dev. of 3 runs, 10,000 loops each)
</pre></div></div>
</div>
<p>Now we know: each of these inputs has only one solution.</p>
<div class="line-block">
<div class="line">The complexity has gone down from Θ(<em>product</em>³) to</div>
<div class="line">Θ(min(<em>product</em>, sqrt(<em>square sum</em>))²) = Θ(min(<em>product</em>², <em>square sum</em>)).</div>
</div>
<p>An initially cubic algorithm has become quadratic in one input or linear in another, whatever happens to be best for the particular input values. This makes a substantial difference. For <em>product</em> = 1320 and <em>square sum</em> = 365, an initially expected run-time of 30 minutes (Exercise 11.3.1) shrinks to less than a millisecond. That’s the power of systematically thinking about the constraints and using them to reduce the search space.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="11_2_factorisation.html" class="btn btn-neutral float-left" title="11.2. Factorisation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="11_4_permutations.html" class="btn btn-neutral float-right" title="11.4. Searching permutations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020–2025 The Open University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>